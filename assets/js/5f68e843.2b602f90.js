"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[150],{3905:(e,t,a)=>{a.d(t,{Zo:()=>h,kt:()=>d});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},h=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),m=c(a),d=o,f=m["".concat(s,".").concat(d)]||m[d]||p[d]||r;return a?n.createElement(f,i(i({ref:t},h),{},{components:a})):n.createElement(f,i({ref:t},h))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},3817:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var n=a(7462),o=(a(7294),a(3905));const r={sidebar_position:4},i="How to read flame chart",l={unversionedId:"docs/source/flamechart",id:"docs/source/flamechart",title:"How to read flame chart",description:"What is flame graph?",source:"@site/docs/docs/source/flamechart.md",sourceDirName:"docs/source",slug:"/docs/source/flamechart",permalink:"/perfsee/docs/docs/source/flamechart",draft:!1,editUrl:"https://github.com/perfsee/perfsee/tree/main/docs/docs/docs/source/flamechart.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"documentsSidebar",previous:{title:"VSCode Extensions",permalink:"/perfsee/docs/docs/source/vscode-extensions"},next:{title:"Basic Setting",permalink:"/perfsee/docs/docs/settings/basic-setting"}},s={},c=[{value:"What is flame graph?",id:"what-is-flame-graph",level:2},{value:"How the flame chart is generated",id:"how-the-flame-chart-is-generated",level:2},{value:"How to read the flame chart?",id:"how-to-read-the-flame-chart",level:3},{value:"References",id:"references",level:2}],h={toc:c};function p(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},h,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"how-to-read-flame-chart"},"How to read flame chart"),(0,o.kt)("h2",{id:"what-is-flame-graph"},"What is flame graph?"),(0,o.kt)("p",null,"The usual flame graph is a visualization of the program call stack information during program runtime, with the horizontal coordinate being the function calls and the vertical coordinate the call stack depth. It is named Flame Graph because the visualized image looks like a flame."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"flame graph",src:a(3205).Z,width:"500",height:"508"})),(0,o.kt)("p",null,"In the flame graph, the function calls from bottom to top. Taking the above diagram as an example, the function call is"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"// a => b : function a called function b\nroot\n  => mysqld`handle_select\n    => mysqld`mysql_select\n      => mydqld`JOIN::exec\n        => mysqld`create_sort_index\n          => ...\n")),(0,o.kt)("hr",null),(0,o.kt)("p",null,"As a front-end developer, you must have used the flame chart in ",(0,o.kt)("a",{parentName:"p",href:"https://developer.chrome.com/docs/devtools/evaluate-performance/reference/"},"the performance tab of Chrome Devtools"),"."),(0,o.kt)("p",null,"However, the Flame Chart given by Chrome Devtool usually appears in a different form: the horizontal coordinate is the ",(0,o.kt)("strong",{parentName:"p"},"time (as opposed to the above definition)"),", the vertical coordinate is the call stack depth, and the visualization is an inverted flame or waterfall. Because the meaning of the horizontal coordinate has changed, the Chrome team also calls it a Flame Chart instead of a Flame Graph."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Flame chart",src:a(7364).Z,width:"904",height:"1504"})),(0,o.kt)("p",null,"Obviously in front-end, the latter (Flame Chart) can show more relevant information about page load and execution time, and can be combined with key performance indicators such as FP, FCP, TTI, etc. to give developers intuitive optimization guidance. So what we are going to talk about is Flame Chart."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"how-the-flame-chart-is-generated"},"How the flame chart is generated"),(0,o.kt)("p",null,"Takes a snapshot of the program's ",(0,o.kt)("strong",{parentName:"p"},"current stack")," at regular intervals (100 \u03bcs ~ 1000 \u03bcs, 1000 \u03bcs = 1 ms). Since the snapshot interval is very short, the sum of the time of the same stack in multiple consecutive snapshots can be considered as the ",(0,o.kt)("strong",{parentName:"p"},"execution time")," of the function at the ",(0,o.kt)("strong",{parentName:"p"},"top of the stack"),"."),(0,o.kt)("h3",{id:"how-to-read-the-flame-chart"},"How to read the flame chart?"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Understand the stack and call relationships"))),(0,o.kt)("p",null,"The call stack of functions in the flame chart is the opposite of the upper/lower level relationship in the flame graph, i.e., upper level functions call lower level functions.\nIn the diagram below, the functions are called as ",(0,o.kt)("inlineCode",{parentName:"p"},"i")," calls ",(0,o.kt)("inlineCode",{parentName:"p"},"Ce"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Ce")," calls ",(0,o.kt)("inlineCode",{parentName:"p"},"S.forEach"),", and so on."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Flame chart example",src:a(7448).Z,width:"1292",height:"738"})),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Function execution time"))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Function execution time is the hardest part for people new to flame chart, but it is the most critical part.")),(0,o.kt)("p",null,"Function execution time is divided into ",(0,o.kt)("strong",{parentName:"p"},"Total Time")," and ",(0,o.kt)("strong",{parentName:"p"},"Self Time"),".\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"Total Time")," is easily understood as the total time spent by a function from the first line of the function body to the end of the last line. The self-execution time is the time taken to call the other functions in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Total Time"),".\nSo we have ",(0,o.kt)("inlineCode",{parentName:"p"},"Total Time = Self Time + Children TotalTime"),"."),(0,o.kt)("p",null,"Back in the flame diagram, the ",(0,o.kt)("strong",{parentName:"p"},"time span")," of each node in the diagram in the horizontal coordinate is the ",(0,o.kt)("inlineCode",{parentName:"p"},"total time")," of that function call."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Total time",src:a(1809).Z,width:"1280",height:"351"})),(0,o.kt)("p",null,"As you can see above, the highlighted function ",(0,o.kt)("inlineCode",{parentName:"p"},"checkDeferredModules")," spans 1.32 seconds, which is the ",(0,o.kt)("inlineCode",{parentName:"p"},"total time")," of execution of that function. Moving down the call stack, we see that the function immediately calls another function ",(0,o.kt)("inlineCode",{parentName:"p"},"__webpack_require__"),", and the ",(0,o.kt)("inlineCode",{parentName:"p"},"__webpack_require__")," ",(0,o.kt)("inlineCode",{parentName:"p"},"total time")," is also 1.32 seconds. Based on the time formula above, we can understand that the ",(0,o.kt)("inlineCode",{parentName:"p"},"checkDeferredModules")," function's ",(0,o.kt)("inlineCode",{parentName:"p"},"self-execution time")," ",(0,o.kt)("strong",{parentName:"p"},"is negligibly short"),", so we can ignore this function in our reading and not think about optimizing its performance, and instead focus on the functions it calls.\nSimilarly, in the figure below, function ",(0,o.kt)("inlineCode",{parentName:"p"},"XI")," is the top-level (last called) function, but during its execution the engine triggers a GC, and the remainder of the GC time is the ",(0,o.kt)("inlineCode",{parentName:"p"},"self-execution time")," of function ",(0,o.kt)("inlineCode",{parentName:"p"},"XI"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Self time",src:a(3721).Z,width:"1004",height:"454"})),(0,o.kt)("p",null,"In summary, the first functions we need to focus on in the process of reading the flame chart are those that occupy a longer span of time in the flame chart, and then follow the function call stack path to find out the function calls in the call path ",(0,o.kt)("strong",{parentName:"p"},"self-execution time")," that are longer, and make targeted optimizations."),(0,o.kt)("h2",{id:"references"},"References"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://www.brendangregg.com/flamegraphs.html"},"Flame Graphs")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://developer.chrome.com/docs/devtools/evaluate-performance/reference/"},"Chrome Devtools"))))}p.isMDXComponent=!0},7364:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/chrome-flamechart-0a5041ef5752d8e04cfc0964145a9c3e.jpg"},3205:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/flame-graph-503018f83bcfe335738a2405723f56d4.png"},3721:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/flamechart-self-time-637da5457f84c180987a3b55e67d71d6.png"},7448:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/flamechart-top-down-29516cdc005e6c8a648b32853cd7a44c.png"},1809:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/flamechart-total-time-d33fbc114ecc6e05e7d0b6e8b5d37392.png"}}]);