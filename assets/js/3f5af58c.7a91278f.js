"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[28],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),m=r,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9381:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={sidebar_position:6},i="How to use e2e test",s={unversionedId:"docs/lab/e2e",id:"docs/lab/e2e",title:"How to use e2e test",description:"This feature is still in experimental stage!",source:"@site/docs/docs/lab/e2e.md",sourceDirName:"docs/lab",slug:"/docs/lab/e2e",permalink:"/perfsee/docs/docs/lab/e2e",draft:!1,editUrl:"https://github.com/perfsee/perfsee/tree/main/docs/docs/docs/lab/e2e.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"documentsSidebar",previous:{title:"Setting commit hash",permalink:"/perfsee/docs/docs/lab/set-commit"},next:{title:"Metrics gallery",permalink:"/perfsee/docs/docs/lab/metrics-gallery"}},l={},p=[{value:"Background",id:"background",level:2},{value:"Features",id:"features",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Step 0: Add configuration",id:"step-0-add-configuration",level:3},{value:"Step 1: Add e2e page",id:"step-1-add-e2e-page",level:3},{value:"Step 2: Write E2E Test Scripts",id:"step-2-write-e2e-test-scripts",level:3},{value:"E2E testing environments",id:"e2e-testing-environments",level:4},{value:"Example",id:"example",level:4},{value:"User Flow",id:"user-flow",level:4},{value:"Step 3\uff1aTake an E2E Snapshot manually",id:"step-3take-an-e2e-snapshot-manually",level:3},{value:"Step 4\uff1aView the result",id:"step-4view-the-result",level:3},{value:"Overview",id:"overview",level:4},{value:"User Flow",id:"user-flow-1",level:4}],c={toc:p};function u(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-use-e2e-test"},"How to use e2e test"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This feature is still in experimental stage!")),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,"The current Lab module is only geared towards first screen performance and cannot test user interoperability."),(0,r.kt)("p",null,"When doing performance analysis, some user interaction performance metrics can only be measured manually using chrome devtool, so a way to automatically measure page interaction performance and quantify it into performance metrics is needed."),(0,r.kt)("h2",{id:"features"},"Features"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Support for running user-supplied Puppeteer scripts to test page functionality and user interaction performance."),(0,r.kt)("li",{parentName:"ul"},"Integrated ",(0,r.kt)("a",{parentName:"li",href:"https://web.dev/lighthouse-user-flows/"},"Lighthouse User Flow")," feature to measure performance metrics and provide best practice recommendations."),(0,r.kt)("li",{parentName:"ul"},"Focuses on performance analysis, providing performance analysis tools such as Flame Chart, Treemap, Lighthouse and more."),(0,r.kt)("li",{parentName:"ul"},"Combined with the Source feature, it locates performance issues to the source code location.")),(0,r.kt)("h2",{id:"getting-started"},"Getting Started"),(0,r.kt)("h3",{id:"step-0-add-configuration"},"Step 0: Add configuration"),(0,r.kt)("p",null,"Follow the steps in ",(0,r.kt)("a",{parentName:"p",href:"./get-started"},"Getting Started")," to edit Profiles and Environments."),(0,r.kt)("h3",{id:"step-1-add-e2e-page"},"Step 1: Add e2e page"),(0,r.kt)("p",null,"Navigating to ",(0,r.kt)("strong",{parentName:"p"},"Project\u2192Settings\u2192E2E"),".\nClick the ",(0,r.kt)("inlineCode",{parentName:"p"},"Create a new E2E test")," button to create an E2E page."),(0,r.kt)("p",null,"As E2E is still in the experimental stage, the entrance is not open, you can enter it manually in the address bar: ",(0,r.kt)("strong",{parentName:"p"},"settings/e2e")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"e2e",src:a(2477).Z,width:"2622",height:"792"})),(0,r.kt)("p",null,"E2E page configuration is the same as the normal page, refer to ",(0,r.kt)("a",{parentName:"p",href:"https://"},"Pages Configuration")," for more details."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"create e2e",src:a(9977).Z,width:"2600",height:"1494"})),(0,r.kt)("h3",{id:"step-2-write-e2e-test-scripts"},"Step 2: Write E2E Test Scripts"),(0,r.kt)("p",null,"This platform uses ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/puppeteer/puppeteer"},"puppeteer")," to run E2E tests. E2E scripts are compatible with most common puppeteer APIs."),(0,r.kt)("h4",{id:"e2e-testing-environments"},"E2E testing environments"),(0,r.kt)("p",null,"A Puppeteer instance is created in advance of running the E2E script, open the browser, create a tab, and the Profiles and Environments configured on the platform are automatically injected into the browser tab. The tab is injected into the script environment global variable ",(0,r.kt)("inlineCode",{parentName:"p"},"page"),". ",(0,r.kt)("strong",{parentName:"p"},"The E2E script only needs to call the methods on ",(0,r.kt)("inlineCode",{parentName:"strong"},"page")," to operate it"),". See ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/puppeteer/puppeteer/blob/v13.0.1/docs/api.md#class-page"},"puppeteer class-page API")," for more methods."),(0,r.kt)("h4",{id:"example"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"await page.goto('https://a.b.c/')\n\n// Click on the div with the classname ms-list-cell and containing appmonitor/main\n\nconst [project] = await page.$x(\"//div[contains(@class, 'ms-List-cell') and contains(., 'appmonitor/main')]\")\n\nawait project.click()\n\n// wait for redirection\n\nawait page.waitForNetworkIdle()\n")),(0,r.kt)("h4",{id:"user-flow"},"User Flow"),(0,r.kt)("p",null,"In order to analyze the performance metrics of user actions at runtime, such as time spent per redirect, response time per click, etc., we divide the entire script into Steps, each of which generates performance metrics."),(0,r.kt)("p",null,"A Step is automatically started when the following actions are triggered in the script."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"goto"),(0,r.kt)("li",{parentName:"ul"},"reload"),(0,r.kt)("li",{parentName:"ul"},"goBack"),(0,r.kt)("li",{parentName:"ul"},"goForward"),(0,r.kt)("li",{parentName:"ul"},"click"),(0,r.kt)("li",{parentName:"ul"},"focus"),(0,r.kt)("li",{parentName:"ul"},"hover"),(0,r.kt)("li",{parentName:"ul"},"select"),(0,r.kt)("li",{parentName:"ul"},"tap"),(0,r.kt)("li",{parentName:"ul"},"type"),(0,r.kt)("li",{parentName:"ul"},"All methods of class Mouse"),(0,r.kt)("li",{parentName:"ul"},"All methods of class Touchscreen"),(0,r.kt)("li",{parentName:"ul"},"All methods of class Keyboard"),(0,r.kt)("li",{parentName:"ul"},"drag&drop of class ElementHandle")),(0,r.kt)("p",null,"If you want to combine multiple actions into one Step, such as mouse press, move, and then release to simulate a drag operation, you need to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"startStep")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"endStep")," methods on the global object ",(0,r.kt)("inlineCode",{parentName:"p"},"flow"),"."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"await flow.startStep('<Step Name>')\n\nawait page.mouse.down()\nawait page.mouse.move(0, 100)\nawait page.mouse.move(100, 100)\nawait page.mouse.move(100, 0)\nawait page.mouse.move(0, 0)\nawait page.mouse.up()\n\nawait flow.endStep()\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"page.goto is a special Step that should not be called between ",(0,r.kt)("inlineCode",{parentName:"strong"},"flow.startStep")," and ",(0,r.kt)("inlineCode",{parentName:"strong"},"flow.endStep"),".")),(0,r.kt)("h3",{id:"step-3take-an-e2e-snapshot-manually"},"Step 3\uff1aTake an E2E Snapshot manually"),(0,r.kt)("p",null,"Navigate to ",(0,r.kt)("strong",{parentName:"p"},"Project\u2192Lab")," and click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Take a snapshot")," button at the top right of the page to select the e2e page you want to test to trigger a scan."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"take snapshot",src:a(9480).Z,width:"2506",height:"1382"})),(0,r.kt)("h3",{id:"step-4view-the-result"},"Step 4\uff1aView the result"),(0,r.kt)("p",null,"Clicking on the Snapshot card in the Lab module will display all the results of this run and click the page name to go to the report you want to view."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"snapshot detail",src:a(9050).Z,width:"2594",height:"866"})),(0,r.kt)("h4",{id:"overview"},"Overview"),(0,r.kt)("p",null,"When you go to the report page, the time that is taken to run the analysis and the number of steps for this E2E script execution are displayed, as well as a runtime video."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"overview",src:a(2485).Z,width:"2398",height:"1130"})),(0,r.kt)("h4",{id:"user-flow-1"},"User Flow"),(0,r.kt)("p",null,"Click on the User Flow tab on the report page to see the performance analysis data and optimization recommendations for each Step. Click on the thumbnail on the timeline to jump to the next Step."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"userflow",src:a(9417).Z,width:"2296",height:"1630"})))}u.isMDXComponent=!0},2485:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/e2e-report-overview-ab0a72c0430b3d7d170e15aad0891163.png"},9417:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/e2e-report-userflow-08532d3839415741111c30fa72d5fb35.png"},9050:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/e2e-take-snapshot-detail-746787a548dc419609bb42d3b91925a0.png"},9480:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/e2e-take-snapshot-27fca626b2dbbea0be462acace6095bd.png"},9977:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create-e2e-f0628260e30d988654e265b43638bab7.png"},2477:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/e2e-f856562e37e450e9c0a3e6eff571f092.png"}}]);